# 🧪 Heracles NEO: AIを活用した科学研究データ解析パイプライン

<p align="left">
  <img src="https://img.shields.io/badge/Python-3.12-blue.svg?style=for-the-badge&logo=python" alt="Python 3.12">
  <img src="https://img.shields.io/badge/scikit--learn-1.5-orange.svg?style=for-the-badge&logo=scikit-learn" alt="Scikit-learn">
  <img src="https://img.shields.io/badge/SHAP-0.45-brightgreen.svg?style=for-the-badge" alt="SHAP">
  <img src="https://img.shields.io/badge/Plotly-5.22-blueviolet.svg?style=for-the-badge&logo=plotly" alt="Plotly">
  <img src="https://img.shields.io/badge/Jupyter-Notebook-F37626.svg?style=for-the-badge&logo=jupyter" alt="Jupyter Notebook">
</p>

## 1. プロジェクト概要：AI時代の科学解析

このプロジェクトは、複雑な多変量データ（化学物質ピーク強度など）を対象に、「**誰でも再現可能**」かつ「**AIが判断根拠を説明できる**」形で、グループ間の違いを多角的に解析し、最終的なレポートまでを自動生成する統合パイプラインです。

### 📌 開発の目的（課題解決）
1. **信頼性の確保：** 統計学（ANOVA）とAI（Random Forest）のハイブリッド採点により、主観に頼らない頑健な（ロバストな）重要特徴量を特定します。
2. **AIの透明化（XAI）：** SHAP を用いて、AIモデルの判断根拠を解釈可能な形で可視化し、ブラックボックス化を防ぎます。
3. **属人化の排除：** データ入力から最終レポート出力 までを全自動化し、解析の再現性を担保します。
4. **デザインと伝達：** 解析結果を、専門知識のない相手にも伝わる「美しいHTMLレポート」 として納品します。



### 🔑機密データ処理の設計（セキュリティ戦略）
このパイプラインは、セキュリティと専門性の両立を重視した「2段階アーキテクチャ」で設計されています。

1.**「非公開」のフェーズ（ローカル処理)**

    役割：重要ピーク抽出.ipynb は、機密データ（研究の生データ）をローカル環境で扱い、外部に出してはいけない『中間ファイル（総合重要ピークリスト.xlsx）』を生成する「前処理の心臓部」です。
    セキュリティ対策 ：機密情報に触れるコードを意図的にGitHubから切り離し（非公開とし）、その安全なプロセスだけを「システム構図」で示しました。


2.**「公開・デモ」のフェーズ（本解析）**

    役割： GitHubで公開しているPortfolio_AI解析.ipynb は、機密情報を含まない安全なデータ（ワインデータ） を使って、解析の「ロジック」と「考察の自動化」という技術力のみを証明するデモ版です。

### システム構成図
![AI解析_ポートフォリオ_構造図](https://github.com/user-attachments/assets/91a84fc0-00e7-46ed-b9ee-6716bb76a8e8)


---

## 2. 最終成果物：AIによる自動考察HTMLレポート

本パイプラインは、最終的に「`⭐︎ Heracles NEO 総合解析レポート.html`」という単一のHTMLファイルを出力します。

### HTML出力例
<img width="891" height="752" alt="スクリーンショット 2025-11-03 14 22 13" src="https://github.com/user-attachments/assets/a18c988e-8224-47d6-8222-a167270e3aaf" />


---

## 3. システムアーキテクチャとデータパイプライン

### 堅牢なデータ準備フェーズ（設計思想）
本パイプラインは、**3つの異なる入力ソース**を統合する高度な設計を採用しています。



1.  **データ読み込み・クレンジング (セル2):**
    * 汚れた生データ（`生データ.txt`）から、独自の関数（`transform_column_name`）により、カラム名の自動整形（例：`'2,111.92-2'` → `'2111-2'`）とブランクサンプルの除去を実行します。
2.  **多段的な外れ値処理 (セル7, 8, 9):**
    * **サンプル単位の除去（PCA基準）**、**ピーク単位の棄却検定（Z-score基準）**、**最終IQR基準** という3段階のクリーニングをグループごとに適用。
    * 欠損値は、安易なゼロ埋めではなく、**グループごとの中央値補完** という統計的に堅牢な手法で処理します。
3.  **化学情報のマージ (セル5):**
    * 外部の専門知識（`ピーク一覧/*.txt`）を自動で読み込み、データに「化学物質名」「官能的記述子」 を紐付けます。この情報がAIの解釈 の根拠となります。

---

## 4. 実装された分析アプローチと可視化手法

### A. MVA（多変量解析）フルコースによる「全体像」の可視化
データ構造を「多角的」に理解するため、6つの異なる「地図」を全自動で描画します。

| 手法 | 目的（なぜその手法を使うか） | 出力画像 |
| :--- | :--- | :--- |
| **PCA / PLS-DA / LDA** | グループ分離軸の特定とデータ全体の自然なばらつきの把握。 | `PCAプロット.png`, `PLS-DAプロット.png`, `LDAプロット.png` |
| **UMAP / t-SNE**| 複雑なデータの非線形構造を可視化し、隠れたクラスターがないか探索する。 | `UMAPプロット.png`, `t-SNEプロット.png` |
| **階層的クラスタリング** | サンプル間の系統樹（家系図）を作成し、グループの類似度関係を視覚化する。 | `階層的クラスタリング.png` |
| **クロマトグラム** | 全ピークの「化学的指紋」を比較する。 | `全グループ比較クロマトグラム_*.png` |

### B. 「ハイブリッド採点エンジン」による重要ピークの特定 [セル14]
全ピークを以下の2つの「専門家」の視点から採点し、「総合ランク」 を算出します。

* **専門家A (統計学):** ANOVA と多重比較補正（q値）による「有意差」の採点。
* **専門家B (AI):** ランダムフォレスト の**Feature Importance** による「分類への貢献度」の採点。

### C. 補足分析による「多角的な検証」
| 分析項目 | 目的（なぜその分析が必要か） | 出力画像/ファイル |
| :--- | :--- | :--- |
| **相関ヒートマップ** | **統合ランク上位20ピーク**が互いに独立か、連動して変動する「仲間」 なのかを視覚的に調査する。 | `相関ヒートマップ.png` |
| **ボルケーノプロット** | 特定の2群間に絞り込み、「信頼性（p値）」と「変動の大きさ（Fold Change）」を同時検証する。 | `ボルケーノプロット_*.png` |
| **バイオリンプロット** | AIが重要と判断したピークが、視覚的にも明確な差（分布の違い）を示しているかの最終検証。 | `最重要特徴量バイオリンプロット.png` |
| **モデル性能評価** | 交差検証（Cross-Validation） により、モデルの**真の予測性能**（`平均正解率`）を推定する。 | `モデル性能評価.png` |
| **グループ距離分析** | グループ内の「まとまり具合（内部距離）」と、グループ間の「離れ具合（重心間距離）」を定量化する。 | `内部距離.png`, `グループ間距離.png` |

---

## 5. 最終成果物：自動生成レポートのハイライト

### A. AIによる統合考察 [セル26]
* **軸解釈:** PCAローディング のトップピークを自動で抽出し、その化学情報 に基づき「PC1軸は『A香』と『B香』の対比軸である」という文章を自動生成します。
* **グループプロファイル:** 各グループの均一性、他グループとの距離、AIが判断に用いたトップピーク を統合した「特徴プロファイル」を自動で書き下します。
* **納品物の証拠:** 解析に必要なPython、Pandas、SHAP等の**バージョン情報** をレポート末尾に自動記載することで、再現性を技術的に保証します。

### B. 特記事項 (Engineering Excellence)
* **デザイン統合:** Plotly とカスタムCSS を用いて、グラフの可視性、フォント、レイアウトの統一性を極限まで高めています。
* **堅牢性:** サンプル数に応じて交差検証の分割数 を自動調整したり、`output_dir` をタイムスタンプ でユニークにするなど、エラーや混同を防ぐための多数の安全装置 を実装しています。

---

## 6. 実行手順（再現性の検証）
このリポジトリで公開しているipynbファイルは、実際の研究データ（非公開）を、「**公開練習用データセット（ワインデータ）**」に差し替えた「技術デモ」版です。

1. 本リポジトリをダウンロードします。
2. Portfolio_AI解析.ipynb をVS Codeなどで開きます。
3. セル0（自動セットアップ） を実行します。pip install が走り、解析に必要な全ライブラリが自動でインストールされます。
4. すべてのセルを順に実行します。
5. セル2 が「ワインデータ」 を自動で読み込み、セル28 が（ワインデータに基づいた）「⭐︎ Heracles NEO 総合解析レポート.html」 をタイムスタンプ付きフォルダ に自動生成します。
